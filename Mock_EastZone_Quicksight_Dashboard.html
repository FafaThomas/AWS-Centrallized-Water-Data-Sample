<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>East Zone Dashboard</title>
    <link href="./dist/output.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.1/dist/echarts.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
    </style>
</head>
<body class="p-6 md:p-10">

    <!-- Dashboard Header -->
    <header class="bg-white p-6 rounded-xl shadow-md mb-6 flex items-center justify-between">
        <div>
            <h1 class="text-3xl font-bold text-gray-800">East Zone Dashboard</h1>
            <p class="text-gray-500 mt-1">Key Performance Indicators for Water Management</p>
        </div>
        <a href="index.html" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-full transition duration-300">
            Home
        </a>
    </header>

    <main class="space-y-6">

        <!-- Combined Production Performance Charts -->
        <h2 class="text-2xl font-semibold text-gray-800 mt-6 mb-4">Combined Production Performance Charts</h2>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

            <!-- Combined East Zone Production Chart -->
            <div class="bg-white p-6 rounded-xl shadow-md h-80 md:h-96 flex flex-col">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Combined East Zone Production</h2>
                <div class="relative flex-grow">
                    <canvas id="combinedEastZoneChart"></canvas>
                </div>
            </div>

            <!-- Pump Station A Chart -->
            <div class="bg-white p-6 rounded-xl shadow-md h-80 md:h-96 flex flex-col">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Monthly Performance - Pump Station A</h2>
                <div class="relative flex-grow">
                    <canvas id="pumpStationAChart"></canvas>
                </div>
            </div>

            <!-- Pump Station B Chart -->
            <div class="bg-white p-6 rounded-xl shadow-md h-80 md:h-96 flex flex-col">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Monthly Performance - Pump Station B</h2>
                <div class="relative flex-grow">
                    <canvas id="pumpStationBChart"></canvas>
                </div>
            </div>

            <!-- Pump Station C Chart -->
            <div class="bg-white p-6 rounded-xl shadow-md h-80 md:h-96 flex flex-col">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Monthly Performance - Pump Station C</h2>
                <div class="relative flex-grow">
                    <canvas id="pumpStationCChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Combined System's Performance Charts -->
        <h2 class="text-2xl font-semibold text-gray-800 mt-10 mb-4">Combined System's Performance Charts</h2>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

            <!-- Combined East Zone Performance Chart -->
            <div class="bg-white p-6 rounded-xl shadow-md h-80 md:h-96 flex flex-col">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Combined East Zone Performance</h2>
                <div class="relative flex-grow">
                    <canvas id="combinedSystemChart"></canvas>
                </div>
            </div>

            <!-- Pump Station A System Chart -->
            <div class="bg-white p-6 rounded-xl shadow-md h-80 md:h-96 flex flex-col">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Monthly System Performance - Pump Station A</h2>
                <div class="relative flex-grow">
                    <canvas id="pumpStationASystemChart"></canvas>
                </div>
            </div>

            <!-- Pump Station B System Chart -->
            <div class="bg-white p-6 rounded-xl shadow-md h-80 md:h-96 flex flex-col">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Monthly System Performance - Pump Station B</h2>
                <div class="relative flex-grow">
                    <canvas id="pumpStationBSystemChart"></canvas>
                </div>
            </div>

            <!-- Pump Station C System Chart -->
            <div class="bg-white p-6 rounded-xl shadow-md h-80 md:h-96 flex flex-col">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Monthly System Performance - Pump Station C</h2>
                <div class="relative flex-grow">
                    <canvas id="pumpStationCSystemChart"></canvas>
                </div>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const labels = ['Pump Station A', 'Pump Station B', 'Pump Station C'];
            const dataKeys = ['ps_a', 'ps_b', 'ps_c'];
            const colors = ['rgb(59, 130, 246)', 'rgb(74, 222, 128)', 'rgb(239, 68, 68)'];

            // Sample data for each pump station (East Zone data)
            const combinedData = {
                ps_a: {
                    kwh: [0.55, 0.52, 0.50, 0.54, 0.53, 0.56, 0.55, 0.52, 0.51, 0.49, 0.48, 0.47],
                    energy: [6500, 6200, 6000, 6400, 6300, 6600, 6500, 6200, 6100, 5900, 5800, 5700],
                    volume: [12000, 11800, 11500, 12200, 12100, 12500, 12300, 11900, 11700, 11600, 11800, 11900]
                },
                ps_b: {
                    kwh: [0.40, 0.38, 0.37, 0.39, 0.41, 0.42, 0.40, 0.38, 0.36, 0.35, 0.34, 0.33],
                    energy: [4500, 4200, 4000, 4400, 4300, 4600, 4500, 4200, 4100, 3900, 3800, 3700],
                    volume: [9000, 8800, 8500, 9200, 9100, 9500, 9300, 8900, 8700, 8600, 8800, 8900]
                },
                ps_c: {
                    kwh: [0.65, 0.68, 0.69, 0.71, 0.70, 0.69, 0.68, 0.67, 0.66, 0.65, 0.64, 0.63],
                    energy: [7500, 7300, 7400, 7600, 7550, 7450, 7400, 7200, 7100, 7000, 6900, 6800],
                    volume: [11000, 10800, 10900, 11100, 11050, 10950, 10850, 10700, 10600, 10500, 10400, 10300]
                }
            };

            // Calculate combined data for all pump stations
            const totalEastZoneData = {
                kwh: [],
                energy: [],
                volume: []
            };

            for (let i = 0; i < months.length; i++) {
                totalEastZoneData.kwh.push(
                    (combinedData.ps_a.kwh[i] + combinedData.ps_b.kwh[i] + combinedData.ps_c.kwh[i]) / 3
                );
                totalEastZoneData.energy.push(
                    combinedData.ps_a.energy[i] + combinedData.ps_b.energy[i] + combinedData.ps_c.energy[i]
                );
                totalEastZoneData.volume.push(
                    combinedData.ps_a.volume[i] + combinedData.ps_b.volume[i] + combinedData.ps_c.volume[i]
                );
            }

            // Sample data for NRW and billed volume
            const nrwData = {
                ps_a: [25, 23, 22, 24, 23, 26, 25, 23, 21, 20, 19, 18],
                ps_b: [30, 28, 27, 29, 28, 31, 30, 28, 26, 25, 24, 23],
                ps_c: [15, 16, 17, 15, 14, 16, 15, 14, 13, 12, 11, 10]
            };
            const nrwColors = ['rgb(59, 130, 246)', 'rgb(239, 68, 68)', 'rgb(74, 222, 128)'];

            // Calculate billed volume based on NRW
            const billedData = {};
            for (const key of dataKeys) {
                billedData[key] = combinedData[key].volume.map((volume, index) => {
                    return volume * (1 - nrwData[key][index] / 100);
                });
            }
            
            // Calculate combined billed and NRW data
            const totalBilledData = [];
            const totalNRWData = [];
            for (let i = 0; i < months.length; i++) {
                totalBilledData.push(
                    billedData.ps_a[i] + billedData.ps_b[i] + billedData.ps_c[i]
                );
                totalNRWData.push(
                    (nrwData.ps_a[i] + nrwData.ps_b[i] + nrwData.ps_c[i]) / 3
                );
            }

            // Chart configuration and creation functions
            const createProductionChart = (canvasId, volumeData, energyData, kwhData) => {
                const ctx = document.getElementById(canvasId).getContext('2d');
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: months,
                        datasets: [
                            {
                                label: 'Monthly Water Volume (m続)',
                                data: volumeData,
                                backgroundColor: 'rgba(59, 130, 246, 0.6)',
                                borderColor: 'rgb(59, 130, 246)',
                                borderWidth: 1,
                                borderRadius: 5,
                                yAxisID: 'y'
                            },
                            {
                                label: 'Monthly Energy (kWh)',
                                data: energyData,
                                backgroundColor: 'rgba(74, 222, 128, 0.6)',
                                borderColor: 'rgb(74, 222, 128)',
                                borderWidth: 1,
                                borderRadius: 5,
                                yAxisID: 'y'
                            },
                            {
                                label: 'kWh per Cubic Meter',
                                data: kwhData,
                                borderColor: 'rgb(239, 68, 68)',
                                backgroundColor: 'rgba(239, 68, 68, 0.2)',
                                tension: 0.3,
                                type: 'line',
                                pointBackgroundColor: 'rgb(239, 68, 68)',
                                yAxisID: 'y1'
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: {
                                    color: '#4b5563'
                                }
                            }
                        },
                        scales: {
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                grid: {
                                    color: '#e5e7eb'
                                },
                                ticks: {
                                    color: '#6b7280'
                                }
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                grid: {
                                    drawOnChartArea: false,
                                    color: '#e5e7eb'
                                },
                                ticks: {
                                    color: '#ef4444'
                                }
                            },
                            x: {
                                grid: {
                                    display: false
                                },
                                ticks: {
                                    color: '#6b7280'
                                }
                            }
                        }
                    }
                });
            };

            const createSystemChart = (canvasId, volumeData, billedData, nrwData) => {
                 const ctx = document.getElementById(canvasId).getContext('2d');
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: months,
                        datasets: [
                            {
                                label: 'System Input Volume (m続)',
                                data: volumeData,
                                backgroundColor: 'rgba(59, 130, 246, 0.6)',
                                borderColor: 'rgb(59, 130, 246)',
                                borderWidth: 1,
                                borderRadius: 5,
                                yAxisID: 'y-vol'
                            },
                            {
                                label: 'Billed Consumption (m続)',
                                data: billedData,
                                backgroundColor: 'rgba(74, 222, 128, 0.6)',
                                borderColor: 'rgb(74, 222, 128)',
                                borderWidth: 1,
                                borderRadius: 5,
                                yAxisID: 'y-vol'
                            },
                            {
                                label: 'NRW %',
                                data: nrwData,
                                borderColor: 'rgb(239, 68, 68)',
                                backgroundColor: 'rgba(239, 68, 68, 0.2)',
                                tension: 0.3,
                                type: 'line',
                                pointBackgroundColor: 'rgb(239, 68, 68)',
                                yAxisID: 'y-nrw'
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: {
                                    color: '#4b5563'
                                }
                            }
                        },
                        scales: {
                            'y-vol': {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                grid: {
                                    color: '#e5e7eb'
                                },
                                ticks: {
                                    color: '#6b7280'
                                },
                                title: {
                                    display: true,
                                    text: 'Volume (m続)'
                                }
                            },
                            'y-nrw': {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                grid: {
                                    drawOnChartArea: false,
                                    color: '#e5e7eb'
                                },
                                ticks: {
                                    color: '#ef4444',
                                    callback: function(value) {
                                        return value + '%';
                                    }
                                },
                                title: {
                                    display: true,
                                    text: 'NRW %'
                                }
                            },
                            x: {
                                grid: {
                                    display: false
                                },
                                ticks: {
                                    color: '#6b7280'
                                }
                            }
                        }
                    }
                });
            };
            
            // Create combined charts for each pump station
            createProductionChart('combinedEastZoneChart', totalEastZoneData.volume, totalEastZoneData.energy, totalEastZoneData.kwh);
            createProductionChart('pumpStationAChart', combinedData.ps_a.volume, combinedData.ps_a.energy, combinedData.ps_a.kwh);
            createProductionChart('pumpStationBChart', combinedData.ps_b.volume, combinedData.ps_b.energy, combinedData.ps_b.kwh);
            createProductionChart('pumpStationCChart', combinedData.ps_c.volume, combinedData.ps_c.energy, combinedData.ps_c.kwh);
            
            // Create the new system performance charts
            createSystemChart('combinedSystemChart', totalEastZoneData.volume, totalBilledData, totalNRWData);
            createSystemChart('pumpStationASystemChart', combinedData.ps_a.volume, billedData.ps_a, nrwData.ps_a);
            createSystemChart('pumpStationBSystemChart', combinedData.ps_b.volume, billedData.ps_b, nrwData.ps_b);
            createSystemChart('pumpStationCSystemChart', combinedData.ps_c.volume, billedData.ps_c, nrwData.ps_c);

        });
    </script>
</body>
</html>
