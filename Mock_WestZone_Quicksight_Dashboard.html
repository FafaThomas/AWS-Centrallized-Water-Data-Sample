<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>West Zone Dashboard</title>
    <link href="./dist/output.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.1/dist/echarts.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
    </style>
</head>
<body class="p-6 md:p-10">

    <!-- Dashboard Header -->
    <header class="bg-white p-6 rounded-xl shadow-md mb-6 flex items-center justify-between">
        <div>
            <h1 class="text-3xl font-bold text-gray-800">West Zone Dashboard</h1>
            <p class="text-gray-500 mt-1">Key Performance Indicators for Water Management</p>
        </div>
        <a href="index.html" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-full transition duration-300">
            Home
        </a>
    </header>

    <main class="space-y-6">

        <!-- Combined Production Performance Charts -->
        <h2 class="text-2xl font-semibold text-gray-800 mt-6 mb-4">Combined Production Performance Charts</h2>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

            <!-- Combined West Zone Production Chart -->
            <div class="bg-white p-6 rounded-xl shadow-md h-80 md:h-96 flex flex-col">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Combined West Zone Production</h2>
                <div class="relative flex-grow">
                    <canvas id="combinedWestZoneChart"></canvas>
                </div>
            </div>

            <!-- Pump Station 1 Chart -->
            <div class="bg-white p-6 rounded-xl shadow-md h-80 md:h-96 flex flex-col">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Monthly Performance - Pump Station 1</h2>
                <div class="relative flex-grow">
                    <canvas id="pumpStation1Chart"></canvas>
                </div>
            </div>

            <!-- Pump Station 2 Chart -->
            <div class="bg-white p-6 rounded-xl shadow-md h-80 md:h-96 flex flex-col">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Monthly Performance - Pump Station 2</h2>
                <div class="relative flex-grow">
                    <canvas id="pumpStation2Chart"></canvas>
                </div>
            </div>

            <!-- Pump Station 3 Chart -->
            <div class="bg-white p-6 rounded-xl shadow-md h-80 md:h-96 flex flex-col">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Monthly Performance - Pump Station 3</h2>
                <div class="relative flex-grow">
                    <canvas id="pumpStation3Chart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Combined System's Performance Charts -->
        <h2 class="text-2xl font-semibold text-gray-800 mt-10 mb-4">Combined System's Performance Charts</h2>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

            <!-- Combined West Zone Performance Chart -->
            <div class="bg-white p-6 rounded-xl shadow-md h-80 md:h-96 flex flex-col">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Combined West Zone Performance</h2>
                <div class="relative flex-grow">
                    <canvas id="combinedSystemChart"></canvas>
                </div>
            </div>

            <!-- Pump Station 1 System Chart -->
            <div class="bg-white p-6 rounded-xl shadow-md h-80 md:h-96 flex flex-col">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Monthly System Performance - Pump Station 1</h2>
                <div class="relative flex-grow">
                    <canvas id="pumpStation1SystemChart"></canvas>
                </div>
            </div>

            <!-- Pump Station 2 System Chart -->
            <div class="bg-white p-6 rounded-xl shadow-md h-80 md:h-96 flex flex-col">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Monthly System Performance - Pump Station 2</h2>
                <div class="relative flex-grow">
                    <canvas id="pumpStation2SystemChart"></canvas>
                </div>
            </div>

            <!-- Pump Station 3 System Chart -->
            <div class="bg-white p-6 rounded-xl shadow-md h-80 md:h-96 flex flex-col">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Monthly System Performance - Pump Station 3</h2>
                <div class="relative flex-grow">
                    <canvas id="pumpStation3SystemChart"></canvas>
                </div>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const labels = ['Pump Station 1', 'Pump Station 2', 'Pump Station 3'];
            const dataKeys = ['ps1', 'ps2', 'ps3'];
            const colors = ['rgb(59, 130, 246)', 'rgb(74, 222, 128)', 'rgb(239, 68, 68)'];

            // Sample data for each pump station (West Zone data)
            const combinedData = {
                ps1: {
                    kwh: [0.45, 0.42, 0.40, 0.44, 0.43, 0.46, 0.45, 0.42, 0.41, 0.39, 0.38, 0.37],
                    energy: [4500, 4200, 4000, 4400, 4300, 4600, 4500, 4200, 4100, 3900, 3800, 3700],
                    volume: [10000, 9800, 9500, 10200, 10100, 10500, 10300, 9900, 9700, 9600, 9800, 9900]
                },
                ps2: {
                    kwh: [0.50, 0.48, 0.47, 0.49, 0.51, 0.52, 0.50, 0.48, 0.46, 0.45, 0.44, 0.43],
                    energy: [5500, 5200, 5000, 5400, 5300, 5600, 5500, 5200, 5100, 4900, 4800, 4700],
                    volume: [11000, 10800, 10500, 11200, 11100, 11500, 11300, 10900, 10700, 10600, 10800, 10900]
                },
                ps3: {
                    kwh: [0.35, 0.38, 0.39, 0.41, 0.40, 0.39, 0.38, 0.37, 0.36, 0.35, 0.34, 0.33],
                    energy: [3500, 3300, 3400, 3600, 3550, 3450, 3400, 3200, 3100, 3000, 2900, 2800],
                    volume: [8000, 7800, 7900, 8100, 8050, 7950, 7850, 7700, 7600, 7500, 7400, 7300]
                }
            };

            // Calculate combined data for all pump stations
            const totalWestZoneData = {
                kwh: [],
                energy: [],
                volume: []
            };

            for (let i = 0; i < months.length; i++) {
                totalWestZoneData.kwh.push(
                    (combinedData.ps1.kwh[i] + combinedData.ps2.kwh[i] + combinedData.ps3.kwh[i]) / 3
                );
                totalWestZoneData.energy.push(
                    combinedData.ps1.energy[i] + combinedData.ps2.energy[i] + combinedData.ps3.energy[i]
                );
                totalWestZoneData.volume.push(
                    combinedData.ps1.volume[i] + combinedData.ps2.volume[i] + combinedData.ps3.volume[i]
                );
            }

            // Sample data for NRW and billed volume
            const nrwData = {
                ps1: [20, 18, 17, 19, 18, 21, 20, 18, 16, 15, 14, 13],
                // Elevated NRW data for Pump Station 2 to create the narrative
                ps2: [45, 42, 41, 44, 43, 46, 45, 42, 40, 39, 38, 37],
                ps3: [12, 13, 14, 12, 11, 13, 12, 11, 10, 9, 8, 7]
            };
            const nrwColors = ['rgb(59, 130, 246)', 'rgb(239, 68, 68)', 'rgb(74, 222, 128)'];

            // Calculate billed volume based on NRW
            const billedData = {};
            for (const key of dataKeys) {
                billedData[key] = combinedData[key].volume.map((volume, index) => {
                    return volume * (1 - nrwData[key][index] / 100);
                });
            }
            
            // Calculate combined billed and NRW data
            const totalBilledData = [];
            const totalNRWData = [];
            for (let i = 0; i < months.length; i++) {
                totalBilledData.push(
                    billedData.ps1[i] + billedData.ps2[i] + billedData.ps3[i]
                );
                totalNRWData.push(
                    (nrwData.ps1[i] + nrwData.ps2[i] + nrwData.ps3[i]) / 3
                );
            }

            // Chart configuration and creation functions
            const createProductionChart = (canvasId, volumeData, energyData, kwhData) => {
                const ctx = document.getElementById(canvasId).getContext('2d');
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: months,
                        datasets: [
                            {
                                label: 'Monthly Water Volume (mÂ³)',
                                data: volumeData,
                                backgroundColor: 'rgba(59, 130, 246, 0.6)',
                                borderColor: 'rgb(59, 130, 246)',
                                borderWidth: 1,
                                borderRadius: 5,
                                yAxisID: 'y'
                            },
                            {
                                label: 'Monthly Energy (kWh)',
                                data: energyData,
                                backgroundColor: 'rgba(74, 222, 128, 0.6)',
                                borderColor: 'rgb(74, 222, 128)',
                                borderWidth: 1,
                                borderRadius: 5,
                                yAxisID: 'y'
                            },
                            {
                                label: 'kWh per Cubic Meter',
                                data: kwhData,
                                borderColor: 'rgb(239, 68, 68)',
                                backgroundColor: 'rgba(239, 68, 68, 0.2)',
                                tension: 0.3,
                                type: 'line',
                                pointBackgroundColor: 'rgb(239, 68, 68)',
                                yAxisID: 'y1'
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: {
                                    color: '#4b5563'
                                }
                            }
                        },
                        scales: {
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                grid: {
                                    color: '#e5e7eb'
                                },
                                ticks: {
                                    color: '#6b7280'
                                }
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                grid: {
                                    drawOnChartArea: false,
                                    color: '#e5e7eb'
                                },
                                ticks: {
                                    color: '#ef4444'
                                }
                            },
                            x: {
                                grid: {
                                    display: false
                                },
                                ticks: {
                                    color: '#6b7280'
                                }
                            }
                        }
                    }
                });
            };

            const createSystemChart = (canvasId, volumeData, billedData, nrwData) => {
                 const ctx = document.getElementById(canvasId).getContext('2d');
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: months,
                        datasets: [
                            {
                                label: 'System Input Volume (mÂ³)',
                                data: volumeData,
                                backgroundColor: 'rgba(59, 130, 246, 0.6)',
                                borderColor: 'rgb(59, 130, 246)',
                                borderWidth: 1,
                                borderRadius: 5,
                                yAxisID: 'y-vol'
                            },
                            {
                                label: 'Billed Consumption (mÂ³)',
                                data: billedData,
                                backgroundColor: 'rgba(74, 222, 128, 0.6)',
                                borderColor: 'rgb(74, 222, 128)',
                                borderWidth: 1,
                                borderRadius: 5,
                                yAxisID: 'y-vol'
                            },
                            {
                                label: 'NRW %',
                                data: nrwData,
                                borderColor: 'rgb(239, 68, 68)',
                                backgroundColor: 'rgba(239, 68, 68, 0.2)',
                                tension: 0.3,
                                type: 'line',
                                pointBackgroundColor: 'rgb(239, 68, 68)',
                                yAxisID: 'y-nrw'
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: {
                                    color: '#4b5563'
                                }
                            }
                        },
                        scales: {
                            'y-vol': {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                grid: {
                                    color: '#e5e7eb'
                                },
                                ticks: {
                                    color: '#6b7280'
                                },
                                title: {
                                    display: true,
                                    text: 'Volume (mÂ³)'
                                }
                            },
                            'y-nrw': {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                grid: {
                                    drawOnChartArea: false,
                                    color: '#e5e7eb'
                                },
                                ticks: {
                                    color: '#ef4444',
                                    callback: function(value) {
                                        return value + '%';
                                    }
                                },
                                title: {
                                    display: true,
                                    text: 'NRW %'
                                }
                            },
                            x: {
                                grid: {
                                    display: false
                                },
                                ticks: {
                                    color: '#6b7280'
                                }
                            }
                        }
                    }
                });
            };
            

            // Create combined charts for each pump station
            createProductionChart('combinedWestZoneChart', totalWestZoneData.volume, totalWestZoneData.energy, totalWestZoneData.kwh);
            createProductionChart('pumpStation1Chart', combinedData.ps1.volume, combinedData.ps1.energy, combinedData.ps1.kwh);
            createProductionChart('pumpStation2Chart', combinedData.ps2.volume, combinedData.ps2.energy, combinedData.ps2.kwh);
            createProductionChart('pumpStation3Chart', combinedData.ps3.volume, combinedData.ps3.energy, combinedData.ps3.kwh);
            
            // Create the new system performance charts
            createSystemChart('combinedSystemChart', totalWestZoneData.volume, totalBilledData, totalNRWData);
            createSystemChart('pumpStation1SystemChart', combinedData.ps1.volume, billedData.ps1, nrwData.ps1);
            createSystemChart('pumpStation2SystemChart', combinedData.ps2.volume, billedData.ps2, nrwData.ps2);
            createSystemChart('pumpStation3SystemChart', combinedData.ps3.volume, billedData.ps3, nrwData.ps3);

        });
    </script>
</body>
</html>
